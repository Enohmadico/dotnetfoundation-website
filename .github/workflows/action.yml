
name: DOTNETFOUNDATION-WEBSITE
run-name: DOTNETFOUNDATION-WEBSITE

on:
  push:
    branches:
      - main 
  workflow_dispatch: 

env: 
  DOTNET_ROOT: "."

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: The trigger
        run: |
          Write-Host "The job was triggered automatically by ${{ github.event_name }} event"

      - name: üçè Checkout step
        uses: actions/checkout@v4

      - name: üçè Setup step  
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '3.0.x'

      - name: List directory
        run: |
          dir 

      - name: Install dependencies 
        run: |
          cd src
          dotnet restore

      - name: Build step 
        run: |
          cd src
          dotnet build --configuration Debug --no-restore
          Write-Host "Listing all the directories"
          dir 

      - name: Create foundation folder 
        run: |
          Write-Host "DOTNET_ROOT is: $env:DOTNET_ROOT"
          $path = "$env:DOTNET_ROOT\foundation"

          if (-Not $env:DOTNET_ROOT) {
              Write-Host "DOTNET_ROOT is not set."
              exit 1
          }
          
          if (-Not (Test-Path -Path $path)) {
              Write-Host "Creating directory: $path"
              New-Item -ItemType Directory -Path $path
          } else {
              Write-Host "Directory already exists: $path"
          }

      - name: Publish step 
        run: |
          dotnet publish src\dotnetfoundation-website.csproj -c Debug -o "$env:DOTNET_ROOT\foundation"

      - name: List the files in foundation directory
        run: | 
          Write-Host "Listing the files in foundation directory"
          dir "$env:DOTNET_ROOT\foundation"

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: foundation
          path: "$env:DOTNET_ROOT\foundation\"
          if-no-files-found: error
